<!-- blog/templates/blog/post_detail.html -->
{% extends 'blog/base.html' %}

{% block title %}{{ post.title }}{% endblock %}

{% block content %}
<article class="post">
    <h2>{{ post.title }}</h2>
    {% if post.image %}
        <img src="{{ post.image.url }}" alt="{{ post.title }}">
    {% endif %}
    <p>{{ post.content|linebreaks }}</p>
    <div class="post-meta">
        <p><strong>Автор:</strong> {{ post.author }}</p>
        <p><strong>Опубликовано:</strong> {{ post.published_date|date:"d.m.Y H:i" }}</p>
        <p><strong>Категория:</strong> {{ post.category.name }}</p>
    </div>
    <a href="{% url 'post_list' %}">← Назад к списку постов</a>
</article>

<hr>

<!-- Секция комментариев -->
<div class="comments-section">
    <h3>Комментарии ({{ comments.count }})</h3>

    {% for comment in comments %}
        <div class="comment">
            <div class="comment-header">
                <strong>{{ comment.author }}</strong>
                <span class="comment-date">{{ comment.created_date|date:"d.m.Y H:i" }}</span>
            </div>
            <p>{{ comment.text|linebreaks }}</p>
        </div>
    {% empty %}
        <p>Пока нет комментариев. Будьте первым!</p>
    {% endfor %}

    <!-- Форма добавления комментария -->
    {% if user.is_authenticated %}
        <div class="comment-form">
            <h4>Добавить комментарий</h4>
            <form method="post">
                {% csrf_token %}
                {{ form.as_p }}
                <button type="submit">Отправить</button>
            </form>
        </div>
    {% else %}
        <p><a href="{% url 'admin:login' %}">Войдите</a>, чтобы оставить комментарий.</p>
    {% endif %}
</div>

<style>
    .comment {
        border: 1px solid #ddd;
        padding: 10px;
        margin-bottom: 15px;
        border-radius: 5px;
    }
    .comment-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 5px;
    }
    .comment-date {
        color: #666;
        font-size: 0.9em;
    }
    .comment-form {
        margin-top: 20px;
    }
</style>
{% endblock %}